<!DOCTYPE html>
<html lang="en">
<head>
    <title>JavTube</title>
</head>
<body>
<div class="page type-interior pluginConfigurationPage JavTubeConfigurationPage"
     data-require="emby-input,emby-button,emby-select,emby-checkbox,emby-linkbutton"
     data-role="page">
    <div data-role="content">
        <div class="content-primary">

            <h1>JavTube</h1>

            <div class="readOnlyContent">
                <p class="description1">
                    Just Another Video Tube Plugin for Jellyfin/Emby.
                    <a class="button-link emby-button" href="https://javtube.github.io" is="emby-linkbutton"
                       target="_blank">Learn more.</a>
                </p>
            </div>

            <form class="JavTubeConfigurationForm">

                <div class="inputContainer">
                    <label class="inputeLabel inputLabelUnfocused" for="txtServer">Server</label>
                    <input id="txtServer" is="emby-input" name="txtServer" required type="text"/>
                    <div class="fieldDescription">URL of JavTube Server.</div>
                </div>

                <div class="inputContainer">
                    <label class="inputeLabel inputLabelUnfocused" for="txtToken">Token</label>
                    <input id="txtToken" is="emby-input" name="txtToken" type="text"/>
                    <div class="fieldDescription">Access Token of JavTube Server.</div>
                </div>

                <div class="checkboxContainer checkboxContainer-withDescripton">
                    <label class="emby-checkbox-label">
                        <input id="chkEnableRating" is="emby-checkbox" name="chkEnableRating" type="checkbox"/>
                        <span>Enable Rating</span>
                    </label>
                </div>

                <div class="checkboxContainer checkboxContainer-withDescripton">
                    <label class="emby-checkbox-label">
                        <input id="chkEnableTrailer" is="emby-checkbox" name="chkEnableTrailer" type="checkbox"/>
                        <span>Enable Trailer</span>
                    </label>
                </div>

                <div class="selectContainer">
                    <label class="selectLabel" for="sltTranslationMode">Translation Mode</label>
                    <select class="emby-select-withcolor emby-select sltTranslationMode" id="sltTranslationMode"
                            is="emby-select" name="sltTranslationMode">
                        <option value="Disabled">Disabled</option>
                        <option value="Title">Title</option>
                        <option value="Summary">Summary</option>
                        <option value="All">Translate All</option>
                    </select>
                </div>

                <div class="translationEngineConfiguration">
                    <div class="selectContainer">
                        <label class="selectLabel" for="sltTranslationEngine">Translation Engine</label>
                        <select class="emby-select-withcolor emby-select sltTranslationEngine" id="sltTranslationEngine"
                                is="emby-select" name="sltTranslationEngine">
                            <option value="Baidu">Baidu</option>
                            <option value="Google">Google</option>
                        </select>
                    </div>

                    <div class="baiduApiConfiguration">
                        <div class="inputContainer">
                            <label class="inputeLabel inputLabelUnfocused" for="txtBaiduAppId">Baidu APP ID</label>
                            <input id="txtBaiduAppId" is="emby-input" name="txtBaiduAppId" type="text"/>
                            <div class="fieldDescription"></div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputeLabel inputLabelUnfocused" for="txtBaiduAppKey">Baidu APP Key</label>
                            <input id="txtBaiduAppKey" is="emby-input" name="txtBaiduAppKey" type="text"/>
                            <div class="fieldDescription"></div>
                        </div>
                    </div>

                    <div class="googleApiConfiguration">
                        <div class="inputContainer">
                            <label class="inputeLabel inputLabelUnfocused" for="txtGoogleApiKey">Google API Key</label>
                            <input id="txtGoogleApiKey" is="emby-input" name="txtGoogleApiKey" type="text"/>
                            <div class="fieldDescription"></div>
                        </div>
                    </div>
                </div>

                <div class="inputContainer">
                    <label class="inputLabel inputLabel-float inputLabelUnfocused" for="txtGenreSubstitutionTable">Genre
                        Substitution Table</label>
                    <textarea class="emby-input" id="txtGenreSubstitutionTable" is="emby-input"
                              name="txtGenreSubstitutionTable" rows="10" type="text"></textarea>
                    <div class="fieldDescription"></div>
                </div>

                <div>
                    <button class="raised button-submit block" is="emby-button" type="submit">
                        <span>Save</span></button>
                </div>

            </form>
        </div>
    </div>
    <script type="text/javascript">
        var JavTubePluginConfig = {
            pluginUniqueId: "01cc53ec-c415-4108-bbd4-a684a9801a32"
        };

        $('.sltTranslationMode').on('change', function (_) {
            if (this.value === "Disabled") {
                $('.translationEngineConfiguration').css('display', 'none');
            } else {
                $('.translationEngineConfiguration').css('display', 'inherit');
            }
        });

        $('.sltTranslationEngine').on('change', function (_) {
            if (this.value === "Baidu") {
                $('.baiduApiConfiguration').css('display', 'inherit');
                $('.googleApiConfiguration').css('display', 'none');
            } else if (this.value === "Google") {
                $('.baiduApiConfiguration').css('display', 'none');
                $('.googleApiConfiguration').css('display', 'inherit');
            } else {
                $('.baiduApiConfiguration').css('display', 'none');
                $('.googleApiConfiguration').css('display', 'none');
            }
        });

        $('.JavTubeConfigurationPage').on('pageshow', function () {
            Dashboard.showLoadingMsg();
            var page = this;
            ApiClient.getPluginConfiguration(JavTubePluginConfig.pluginUniqueId).then(function (config) {
                $('#txtServer', page).val(config.Server).change();
                $('#txtToken', page).val(config.Token).change();
                page.querySelector('#chkEnableRating').checked = config.EnableRating;
                page.querySelector('#chkEnableTrailer').checked = config.EnableTrailer;
                $('#sltTranslationMode', page).val(config.TranslationMode).change();
                $('#sltTranslationEngine', page).val(config.TranslationEngine).change();
                $('#txtBaiduAppId', page).val(config.BaiduAppId).change();
                $('#txtBaiduAppKey', page).val(config.BaiduAppKey).change();
                $('#txtGoogleApiKey', page).val(config.GoogleApiKey).change();
                $('#txtGenreSubstitutionTable', page).val(config.GenreSubstitutionTable).change();
                Dashboard.hideLoadingMsg();
            });
        });

        $('.JavTubeConfigurationForm').on('submit', function () {
            Dashboard.showLoadingMsg();
            var form = this;
            ApiClient.getPluginConfiguration(JavTubePluginConfig.pluginUniqueId).then(function (config) {
                config.Server = $('#txtServer', form).val();
                config.Token = $('#txtToken', form).val();
                config.EnableRating = $('#chkEnableRating').prop('checked');
                config.EnableTrailer = $('#chkEnableTrailer').prop('checked');
                config.TranslationMode = $('#sltTranslationMode', form).val();
                config.TranslationEngine = $('#sltTranslationEngine', form).val();
                config.BaiduAppId = $('#txtBaiduAppId', form).val();
                config.BaiduAppKey = $('#txtBaiduAppKey', form).val();
                config.GoogleApiKey = $('#txtGoogleApiKey', form).val();
                config.GenreSubstitutionTable = $('#txtGenreSubstitutionTable', form).val();
                ApiClient.updatePluginConfiguration(JavTubePluginConfig.pluginUniqueId, config).then(
                    Dashboard.processPluginConfigurationUpdateResult);
            });
            // Disable default form submission
            return false;
        });
    </script>
</div>
</body>
</html>