<!DOCTYPE html>
<html lang="en">

<head>
    <title>JavTube</title>
</head>

<body>
<div class="page type-interior pluginConfigurationPage JavTubeConfigurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox,emby-linkbutton" data-role="page">
    <div data-role="content">
        <div class="content-primary">

            <h1>JavTube</h1>

            <div class="readOnlyContent">
                <p class="description1">Just Another Video Tube Plugin for Jellyfin/Emby. <a class="button-link emby-button" href="https://github.com/javtube/jellyfin-plugin-javtube" is="emby-linkbutton" target="_blank">Learn more</a>.</p>
            </div>

            <form class="JavTubeConfigurationForm">

                <div class="verticalSection">
                    <h2>General</h2>

                    <div class="inputContainer">
                        <label class="inputeLabel inputLabelUnfocused" for="txtServer">Server:</label>
                        <input id="txtServer" is="emby-input" name="txtServer" pattern="^https?://.+$" required
                               type="text"/>
                        <div class="fieldDescription">HTTP URL of JavTube Server.</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputeLabel inputLabelUnfocused" for="txtToken">Token:</label>
                        <input id="txtToken" is="emby-input" name="txtToken" type="text"/>
                        <div class="fieldDescription">Access Token of JavTube Server.</div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescripton">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableCollection" is="emby-checkbox" name="chkEnableCollection" type="checkbox"/>
                            <span>Enable Collection</span>
                        </label>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescripton">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableRating" is="emby-checkbox" name="chkEnableRating" type="checkbox"/>
                            <span>Enable Rating</span>
                        </label>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescripton">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableTrailer" is="emby-checkbox" name="chkEnableTrailer" type="checkbox"/>
                            <span>Enable Trailer</span>
                        </label>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">Translation</h2>

                    <div class="selectContainer">
                        <label class="selectLabel" for="selectTranslationMode">Translation mode:</label>
                        <select class="emby-select-withcolor emby-select selectTranslationMode" id="selectTranslationMode" is="emby-select" name="selectTranslationMode">
                            <option value="Disabled">Disabled</option>
                            <option value="Title">Title</option>
                            <option value="Summary">Summary</option>
                            <option value="Both">Title and Summary</option>
                        </select>
                    </div>

                    <div class="selectTranslationModeEnabled">
                        <div class="selectContainer">
                            <label class="selectLabel" for="selectTranslationEngine">Translation engine:</label>
                            <select class="emby-select-withcolor emby-select selectTranslationEngine" id="selectTranslationEngine" is="emby-select" name="selectTranslationEngine">
                                <option value="Baidu">Baidu</option>
                                <option value="Google">Google</option>
                            </select>
                        </div>

                        <div class="selectTranslationEngineBaidu">
                            <div class="inputContainer">
                                <label class="inputeLabel inputLabelUnfocused" for="txtBaiduAppId">Baidu app id:</label>
                                <input id="txtBaiduAppId" is="emby-input" name="txtBaiduAppId" type="text"/>
                                <div class="fieldDescription"></div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputeLabel inputLabelUnfocused" for="txtBaiduAppKey">Baidu app key:</label>
                                <input id="txtBaiduAppKey" is="emby-input" name="txtBaiduAppKey" type="text"/>
                                <div class="fieldDescription"></div>
                            </div>
                        </div>

                        <div class="selectTranslationEngineGoogle">
                            <div class="inputContainer">
                                <label class="inputeLabel inputLabelUnfocused" for="txtGoogleApiKey">Google api key:</label>
                                <input id="txtGoogleApiKey" is="emby-input" name="txtGoogleApiKey" type="text"/>
                                <div class="fieldDescription"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">Substitution</h2>

                    <div class="checkboxContainer checkboxContainer-withDescripton">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableGenreSubstitution" is="emby-checkbox" name="chkEnableGenreSubstitution" type="checkbox"/>
                            <span>Enable Genre Substitution</span>
                        </label>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabel-float inputLabelUnfocused" for="txtGenreSubstitutionTable">Genre substitution table:</label>
                        <textarea class="emby-input" id="txtGenreSubstitutionTable" is="emby-input" name="txtGenreSubstitutionTable" rows="10" type="text"></textarea>
                        <div class="fieldDescription">One record per line, separated by equal signs. Leave the target genre blank to delete the source genre.</div>
                    </div>
                </div>

                <div>
                    <button class="raised button-submit block" is="emby-button" type="submit">
                        <span>Save</span></button>
                </div>

            </form>
        </div>
    </div>
    <script type="text/javascript">
        var JavTubePluginConfig = {
            pluginUniqueId: "01cc53ec-c415-4108-bbd4-a684a9801a32"
        };

        $('.selectTranslationMode').on('change', function (_) {
            if (this.value === "Disabled") {
                $('.selectTranslationModeEnabled').css('display', 'none');
            } else {
                $('.selectTranslationModeEnabled').css('display', 'inherit');
            }
        });

        $('.selectTranslationEngine').on('change', function (_) {
            if (this.value === "Baidu") {
                $('.selectTranslationEngineBaidu').css('display', 'inherit');
                $('.selectTranslationEngineGoogle').css('display', 'none');
            } else if (this.value === "Google") {
                $('.selectTranslationEngineBaidu').css('display', 'none');
                $('.selectTranslationEngineGoogle').css('display', 'inherit');
            } else {
                $('.selectTranslationEngineBaidu').css('display', 'none');
                $('.selectTranslationEngineGoogle').css('display', 'none');
            }
        });

        $('.JavTubeConfigurationPage').on('pageshow', function () {
            Dashboard.showLoadingMsg();
            var page = this;
            ApiClient.getPluginConfiguration(JavTubePluginConfig.pluginUniqueId).then(function (config) {
                $('#txtServer', page).val(config.Server).change();
                $('#txtToken', page).val(config.Token).change();
                page.querySelector('#chkEnableCollection').checked = config.EnableCollection;
                page.querySelector('#chkEnableRating').checked = config.EnableRating;
                page.querySelector('#chkEnableTrailer').checked = config.EnableTrailer;
                $('#selectTranslationMode', page).val(config.TranslationMode).change();
                $('#selectTranslationEngine', page).val(config.TranslationEngine).change();
                $('#txtBaiduAppId', page).val(config.BaiduAppId).change();
                $('#txtBaiduAppKey', page).val(config.BaiduAppKey).change();
                $('#txtGoogleApiKey', page).val(config.GoogleApiKey).change();
                page.querySelector('#chkEnableGenreSubstitution').checked = config.EnableGenreSubstitution;
                $('#txtGenreSubstitutionTable', page).val(config.GenreSubstitutionTable).change();
                Dashboard.hideLoadingMsg();
            });
        });

        $('.JavTubeConfigurationForm').on('submit', function () {
            Dashboard.showLoadingMsg();
            var form = this;
            ApiClient.getPluginConfiguration(JavTubePluginConfig.pluginUniqueId).then(function (config) {
                config.Server = $('#txtServer', form).val();
                config.Token = $('#txtToken', form).val();
                config.EnableCollection = $('#chkEnableCollection', form).prop('checked');
                config.EnableRating = $('#chkEnableRating', form).prop('checked');
                config.EnableTrailer = $('#chkEnableTrailer', form).prop('checked');
                config.TranslationMode = $('#selectTranslationMode', form).val();
                config.TranslationEngine = $('#selectTranslationEngine', form).val();
                config.BaiduAppId = $('#txtBaiduAppId', form).val();
                config.BaiduAppKey = $('#txtBaiduAppKey', form).val();
                config.GoogleApiKey = $('#txtGoogleApiKey', form).val();
                config.EnableGenreSubstitution = $('#chkEnableGenreSubstitution', form).prop('checked');
                config.GenreSubstitutionTable = $('#txtGenreSubstitutionTable', form).val();
                ApiClient.updatePluginConfiguration(JavTubePluginConfig.pluginUniqueId, config).then(Dashboard.processPluginConfigurationUpdateResult);
            });
            // Disable default form submission
            return false;
        });
    </script>
</div>
</body>
</html>